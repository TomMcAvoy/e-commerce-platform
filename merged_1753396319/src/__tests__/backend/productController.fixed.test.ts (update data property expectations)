const request = require('supertest');
const app = require('../../app');

describe('Product Controller - Fixed', () => {
    it('should return products with correct structure', async () => {
        const response = await request(app).get('/api/products');
        expect(response.status).toBe(200);
        expect(response.body.success).toBe(true);
        expect(Array.isArray(response.body.data)).toBe(true);
        response.body.data.forEach(product => {
            expect(product).toHaveProperty('id');
            expect(product).toHaveProperty('name');
            expect(product).toHaveProperty('price');
            expect(product).toHaveProperty('category');
        });
    });

    it('should return single product with virtual fields', async () => {
        const response = await request(app).get('/api/products/1'); // Adjust product ID as necessary
        expect(response.status).toBe(200);
        expect(response.body.success).toBe(true);
        expect(response.body.data).toHaveProperty('id');
        expect(response.body.data).toHaveProperty('name');
        expect(response.body.data).toHaveProperty('price');
        expect(response.body.data).toHaveProperty('description');
    });
});